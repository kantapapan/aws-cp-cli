思考時間: 4 秒


# システム ユースケースシナリオ — *aws‑cp‑cli*

---

## 0. 位置づけ

* ユースケースごとに **アクター・前提条件・基本フロー・代替／例外フロー・完了条件** を明確化し、実装・テストの指針とする。
* 対象は要件定義書 §6 の ★機能：Exam / Practice / Update / Stats。

---

## 1. 一覧

|   UC ID  | 名称               | 主要アクター | 概要                              |
| :------: | ---------------- | ------ | ------------------------------- |
| **UC‑1** | Exam Mode        | 受験者    | 本番同等 65 問・90 分の模擬試験を実施し、スコアを保存  |
| **UC‑2** | Practice Mode    | 受験者    | ドメイン／件数を指定して短時間演習               |
| **UC‑3** | Update Questions | 受験者    | S3 から最新 Parquet をダウンロードしローカルに反映 |
| **UC‑4** | Stats Mode       | 受験者    | 保存された成績を集計し可視化                  |

---

## 2. シナリオ詳細

### UC‑1 Exam Mode — *本番形式模擬試験*

| 項目        | 内容                                                                                                                                           |
| --------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| **アクター**  | **受験者**（Primary）                                                                                                                             |
| **トリガー**  | ユーザーがターミナルで `aws-cp-cli exam` を実行                                                                                                            |
| **前提条件**  | *P‑1* CLI がインストール済み<br>*P‑2* `questions.parquet` が存在し 65 問以上含む                                                                               |
| **基本フロー** | 1. CLI が問題 65 問をランダム取得<br>2. タイマー開始（90 分）<br>3. 1 問ずつ表示 → ユーザーが選択肢入力<br>4. 65 問完了 or タイムアウトで試験終了<br>5. スコア・合否を表示<br>6. 成績を `results.log` に追記 |
| **代替フロー** | **A‑1**：ユーザーが `Ctrl‑C` で中断 → 「再開 / 終了」を選択<br>**A‑2**：問題不足 → エラー表示し終了                                                                         |
| **例外フロー** | **E‑1**：成績保存失敗 → 標準出力に JSON で結果を表示し警告                                                                                                        |
| **後続処理**  | 正常終了・中断に関わらずタイマー停止、CLI 終了コード 0（保存失敗時は 1）                                                                                                     |
| **ポスト条件** | 試験結果がローカルに保存され、ユーザーは合否を認識できる                                                                                                                 |

---

### UC‑2 Practice Mode — *ドメイン別演習*

| 項目        | 内容                                                                                                |
| --------- | ------------------------------------------------------------------------------------------------- |
| **アクター**  | **受験者**                                                                                           |
| **トリガー**  | `aws-cp-cli practice --domain security --count 10`                                                |
| **前提条件**  | CLI & Parquet ファイルが揃っている                                                                          |
| **基本フロー** | 1. CLI が指定ドメインから 10 問取得<br>2. ユーザーが順番に回答<br>3. 各問終了後すぐに正答と解説を表示<br>4. 全問終了後、正答率を表示<br>5. 成績をログに保存 |
| **代替フロー** | **A‑1**：`--count` > 問題数 → 実在最大数に切り詰めるか警告し終了                                                       |
| **例外フロー** | **E‑1**：ログ書込失敗 → 試験は継続、終了時に警告                                                                     |
| **ポスト条件** | ユーザーが苦手ドメインの理解度を確認できる                                                                             |

---

### UC‑3 Update Questions — *問題バンク更新*

| 項目        | 内容                                                                                                                                              |
| --------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| **アクター**  | **受験者**                                                                                                                                         |
| **トリガー**  | `aws-cp-cli update`                                                                                                                             |
| **前提条件**  | インターネット接続・S3 バケットにアクセス可能                                                                                                                        |
| **基本フロー** | 1. CLI が S3 バケットの `questions.parquet` を HEAD し ETag 取得<br>2. 既存ファイルのハッシュと比較<br>3. 差分あり → GET して一時ファイルへ保存<br>4. ダウンロード完了後、原子的に置換<br>5. 成功メッセージ表示 |
| **代替フロー** | **A‑1**：同一 ETag → 「最新です」と表示し終了                                                                                                                  |
| **例外フロー** | **E‑1**：ネットワーク 失敗 → 最大 3 回リトライ→失敗時は旧ファイル保持・コード 1                                                                                                |
| **ポスト条件** | Parquet が最新に更新 or 旧バージョンが保持される                                                                                                                  |

---

### UC‑4 Stats Mode — *成績閲覧*

| 項目        | 内容                                                                           |
| --------- | ---------------------------------------------------------------------------- |
| **アクター**  | **受験者**                                                                      |
| **トリガー**  | `aws-cp-cli stats`                                                           |
| **前提条件**  | `results.log` が存在                                                            |
| **基本フロー** | 1. CLI がログを読み込み<br>2. 全試験の平均スコア・最高スコアを計算<br>3. ドメイン別正答率を算出<br>4. テーブル/グラフで表示 |
| **代替フロー** | **A‑1**：ログが空 → 「成績がありません」と表示                                                 |
| **例外フロー** | **E‑1**：ログ破損 → 読み込み失敗行をスキップし警告                                               |
| **ポスト条件** | ユーザーが学習進捗を把握し、弱点ドメインを認識できる                                                   |

---

## 3. 参照関係と優先実装順

```
UC‑3 (Update)
   ↓           ←―――――――――――――――――――――――――――――――――――
UC‑1 (Exam)  UC‑2 (Practice)     UC‑4 (Stats)
      ↘            ↘                ↑
         ────────> 成績保存 ────────┘
```

*Update* でデータ準備 → *Exam/Practice* で利用 & ログ → *Stats* 観測。
※ UC‑3 が失敗しても *Exam/Practice* は旧問題で実行可能。

---

## 4. 変更履歴

|  版  | 日付         | 変更者     | 内容 |
| :-: | ---------- | ------- | -- |
| 0.1 | 2025‑05‑04 | ChatGPT | 初版 |

---

以上で **ユースケースシナリオ** のまとめは完了です。次に進める項目（例：テストケース詳細、実装ガイドなど）があればお知らせください！
