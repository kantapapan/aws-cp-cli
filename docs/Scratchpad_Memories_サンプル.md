# Scratchpad + Memories サンプル例

このドキュメントは、Scratchpad + Memoriesシステムの具体的な使用例を示しています。実際のプロジェクトでこのシステムをどのように活用するかをイメージするためのサンプルです。

## サンプル1: スクラッチパッド（タスク計画）

以下は、新機能実装のためのタスク計画のサンプルです。

```markdown
# タスク: ユーザー認証機能の実装
作成日時: 2023-11-05 10:30

## 1. 要件分析
- JWT認証システムを実装する
- ユーザー登録、ログイン、ログアウト機能が必要
- セキュリティ要件: パスワードはbcryptでハッシュ化、トークンは24時間で失効
- アクセス制御にはRBAC（Role-Based Access Control）を使用

## 2. 実装計画
1. ユーザーモデルとスキーマの設計
2. パスワードハッシュ化ユーティリティの実装
3. JWT生成・検証ユーティリティの作成
4. 認証ミドルウェアの実装
5. ユーザー登録エンドポイントの実装
6. ログインエンドポイントの実装
7. ログアウト機能の実装
8. RBACミドルウェアの実装
9. 単体テストの作成
10. 統合テストの作成

## 3. 注意点
- JWTシークレットは環境変数から取得し、リポジトリにはコミットしないこと
- リフレッシュトークンの実装も検討する
- フロントエンドとの連携テストも必要
- APIレート制限も考慮する

## 4. 参照
- [JWT公式ドキュメント](https://jwt.io/introduction)
- `/src/models/user.ts` - 既存のユーザー関連モデル
- チケット #AUTH-123
```

## サンプル2: メモリーズ（プロジェクト知見）

以下は、プロジェクト進行中に蓄積した知見の記録例です。

```markdown
## メモリーズエントリ

### [2023-11-01] 初期プロジェクト設定 #setup #architecture
- プロジェクトはClean Architecture原則に従って構造化
  - domain: エンティティとビジネスルール
  - usecase: アプリケーションのユースケース
  - interface-adapter: 外部インターフェースの抽象化
  - infra: 具体的な実装
- ESModulesを使用 (package.jsonのtype: "module")
- TypeScriptコンパイラ設定で実験的デコレータとメタデータ反映を有効化
- 依存性注入にtsyringeを使用

### [2023-11-05] JWT認証実装の注意点 #security #auth
- JWTトークンにはユーザーIDと権限のみを含め、機密情報は含めない
- トークン有効期限は環境によって可変にする (開発:1日、本番:6時間)
- リフレッシュトークンはHTTPOnly + Secure Cookieで保存
- トークン検証失敗時は詳細なエラーメッセージを返さない（セキュリティリスク）
- 実装参考: `/src/auth/jwt.service.ts`

### [2023-11-10] テスト戦略について #testing #pattern
- 各レイヤーのテスト方針:
  - ドメイン層: 100%のカバレッジを目標
  - ユースケース層: モック使用で依存を分離してテスト
  - インターフェース層: 統合テストで検証
  - インフラ層: 実際のDBやサービスと接続するE2Eテスト
- Vitestを使用してテストを高速化
- テストファイルは実装ファイルと同じディレクトリに配置 (`*.test.ts`)
- CI/CDパイプラインでもテストを実行 (GitHub Actions)

### [2023-11-15] パフォーマンス最適化 #performance
- データベースクエリの最適化:
  - N+1問題を避けるためJOINを活用
  - 頻繁に使用されるクエリにはインデックスを作成
- キャッシュ戦略:
  - ユーザープロフィールは5分間Redis内でキャッシュ
  - 静的アセットはCDN経由で配信
- 大量データ処理はバッチ処理で非同期実行
```

## サンプル3: タスク計画から知見記録のフロー例

### ステップ1: タスク計画の作成（AIへの指示）

```
@scratchpad-management.mdc に従い、以下のタスクをスクラッチパッドにまとめて。
過去知識として @memories.md も参照して。

ユーザー認証機能を実装する必要があります。JWT認証を使い、ユーザー登録・ログイン・ログアウト機能を
実装します。セキュリティ面も考慮してください。
```

### ステップ2: AIによる計画立案（スクラッチパッドに記録）

AIが`@scratchpad-management.mdc`のテンプレートに従ってタスク計画を作成し、`@memories.md`から関連知識を参照して補強します。計画はユーザーがレビュー・修正できます。

### ステップ3: 実装フェーズ

計画に基づいて実装を進めます。問題が発生した場合や計画変更が必要な場合は、スクラッチパッドを更新します。

### ステップ4: 知見の記録（タスク完了後）

```
今回得た知見を @memories-management.mdc に従って整理し、
@memories.md に追記候補を出してください。

JWT認証実装中に、トークン有効期限の管理方法やリフレッシュトークンの
セキュアな取り扱いについて学びました。また、トークン検証失敗時のエラー
ハンドリングも重要でした。
```

### ステップ5: AIによる知見の整理

AIが適切なフォーマットで知見を整理し、メモリーズへの追記候補を提案します。ユーザーがレビュー後に承認します。

---

このサイクルを繰り返すことで、プロジェクト知識が継続的に蓄積され、後続のタスクでもAIが過去の知見を参照できるようになります。 